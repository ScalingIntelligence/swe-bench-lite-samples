{
  "info": {
    "duration": 123.08173871040344,
    "submission": "diff --git a/django/db/backends/sqlite3/creation.py b/django/db/backends/sqlite3/creation.py\nindex d97052f52d..81f3d904ad 100644\n--- a/django/db/backends/sqlite3/creation.py\n+++ b/django/db/backends/sqlite3/creation.py\n@@ -18,7 +18,7 @@ class DatabaseCreation(BaseDatabaseCreation):\n         test_database_name = self.connection.settings_dict['TEST']['NAME'] or ':memory:'\n         if test_database_name == ':memory:':\n             return 'file:memorydb_%s?mode=memory&cache=shared' % self.connection.alias\n-        return test_database_name\n+        return test_database_name + '&cache=shared'\n \n     def _create_test_db(self, verbosity, autoclobber, keepdb=False):\n         test_database_name = self._get_test_db_name()\n",
    "total_cost": 0.145794,
    "instance_id": "django__django-12113",
    "evaluation_name": "run_on_remaining_250_for_july_4_t_1.6"
  },
  "name": "AgenticLoop",
  "transitions": [
    {
      "name": "SearchCode",
      "state": {
        "model": "deepseek-coder",
        "message": null,
        "max_tokens": 1000,
        "temperature": 1.6,
        "max_iterations": null,
        "max_search_results": 25,
        "support_test_files": false,
        "initial_context_tokens": 4000,
        "initial_search_results": 50,
        "include_message_history": true,
        "provide_initial_context": true,
        "initial_context_spans_per_file": 5,
        "max_retries_with_any_file_context": 3
      },
      "actions": [
        {
          "action": {
            "complete": false,
            "scratch_pad": "The issue involves a SQLite database being locked during tests with a persistent database configuration. This likely occurs due to concurrent operations or improper handling of connections. To address this, it's crucial to focus on the database connection setup and transaction management aspects in the Django backend for SQLite. Specifically, the SQLite3 backend's handling of database connections and locking mechanisms should be investigated.",
            "search_requests": [
              {
                "query": "database is locked",
                "class_names": [
                  "DatabaseCreation",
                  "DatabaseWrapper",
                  "DatabaseOperations",
                  "BaseDatabaseCreation",
                  "BaseDatabaseWrapper",
                  "BaseDatabaseOperations"
                ],
                "code_snippet": null,
                "file_pattern": "**/backends/sqlite3/**/*.py",
                "function_names": []
              },
              {
                "query": "persistent SQLite databases for tests",
                "class_names": [
                  "DatabaseCreation",
                  "DatabaseWrapper",
                  "DatabaseOperations",
                  "BaseDatabaseCreation",
                  "BaseDatabaseWrapper",
                  "BaseDatabaseOperations"
                ],
                "code_snippet": null,
                "file_pattern": "**/backends/sqlite3/**/*.py",
                "function_names": []
              },
              {
                "query": "SQLite database locking mechanism",
                "class_names": [
                  "DatabaseCreation",
                  "DatabaseWrapper",
                  "DatabaseOperations",
                  "BaseDatabaseCreation",
                  "BaseDatabaseWrapper",
                  "BaseDatabaseOperations"
                ],
                "code_snippet": null,
                "file_pattern": "**/backends/sqlite3/**/*.py",
                "function_names": []
              }
            ]
          },
          "output": {
            "complete": false,
            "ranked_spans": [
              {
                "rank": 0,
                "tokens": 895,
                "span_id": "DatabaseWrapper",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 1,
                "tokens": 854,
                "span_id": "DatabaseWrapper.get_new_connection",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 3,
                "tokens": 61,
                "span_id": "DatabaseWrapper.close",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 3,
                "tokens": 7,
                "span_id": "DatabaseWrapper.init_connection_state",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 3,
                "tokens": 19,
                "span_id": "DatabaseWrapper.enable_constraint_checking",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 3,
                "tokens": 85,
                "span_id": "DatabaseWrapper._set_autocommit",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 3,
                "tokens": 92,
                "span_id": "DatabaseWrapper._savepoint_allowed",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 3,
                "tokens": 18,
                "span_id": "DatabaseWrapper.create_cursor",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 3,
                "tokens": 77,
                "span_id": "DatabaseWrapper.disable_constraint_checking",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 0,
                "tokens": 7,
                "span_id": "DatabaseCreation",
                "file_path": "django/db/backends/sqlite3/creation.py"
              },
              {
                "rank": 0,
                "tokens": 59,
                "span_id": "DatabaseCreation._get_test_db_name",
                "file_path": "django/db/backends/sqlite3/creation.py"
              },
              {
                "rank": 0,
                "tokens": 41,
                "span_id": "DatabaseCreation.is_in_memory_db",
                "file_path": "django/db/backends/sqlite3/creation.py"
              },
              {
                "rank": 2,
                "tokens": 104,
                "span_id": "DatabaseCreation.test_db_signature",
                "file_path": "django/db/backends/sqlite3/creation.py"
              },
              {
                "rank": 2,
                "tokens": 41,
                "span_id": "DatabaseCreation._destroy_test_db",
                "file_path": "django/db/backends/sqlite3/creation.py"
              },
              {
                "rank": 3,
                "tokens": 201,
                "span_id": "DatabaseCreation._clone_test_db",
                "file_path": "django/db/backends/sqlite3/creation.py"
              },
              {
                "rank": 3,
                "tokens": 78,
                "span_id": "DatabaseCreation.get_test_db_clone_settings",
                "file_path": "django/db/backends/sqlite3/creation.py"
              },
              {
                "rank": 4,
                "tokens": 210,
                "span_id": "DatabaseCreation._create_test_db",
                "file_path": "django/db/backends/sqlite3/creation.py"
              },
              {
                "rank": 1,
                "tokens": 895,
                "span_id": "DatabaseWrapper",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 0,
                "tokens": 61,
                "span_id": "DatabaseWrapper.close",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 0,
                "tokens": 7,
                "span_id": "DatabaseWrapper.init_connection_state",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 0,
                "tokens": 19,
                "span_id": "DatabaseWrapper.enable_constraint_checking",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 0,
                "tokens": 85,
                "span_id": "DatabaseWrapper._set_autocommit",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 0,
                "tokens": 92,
                "span_id": "DatabaseWrapper._savepoint_allowed",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 0,
                "tokens": 18,
                "span_id": "DatabaseWrapper.create_cursor",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 0,
                "tokens": 77,
                "span_id": "DatabaseWrapper.disable_constraint_checking",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 1,
                "tokens": 895,
                "span_id": "DatabaseWrapper",
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "rank": 3,
                "tokens": 854,
                "span_id": "DatabaseWrapper.get_new_connection",
                "file_path": "django/db/backends/sqlite3/base.py"
              }
            ],
            "search_requests": [
              {
                "query": "database is locked",
                "class_names": [
                  "DatabaseCreation",
                  "DatabaseWrapper",
                  "DatabaseOperations",
                  "BaseDatabaseCreation",
                  "BaseDatabaseWrapper",
                  "BaseDatabaseOperations"
                ],
                "code_snippet": null,
                "file_pattern": "**/backends/sqlite3/**/*.py",
                "function_names": []
              },
              {
                "query": "persistent SQLite databases for tests",
                "class_names": [
                  "DatabaseCreation",
                  "DatabaseWrapper",
                  "DatabaseOperations",
                  "BaseDatabaseCreation",
                  "BaseDatabaseWrapper",
                  "BaseDatabaseOperations"
                ],
                "code_snippet": null,
                "file_pattern": "**/backends/sqlite3/**/*.py",
                "function_names": []
              },
              {
                "query": "SQLite database locking mechanism",
                "class_names": [
                  "DatabaseCreation",
                  "DatabaseWrapper",
                  "DatabaseOperations",
                  "BaseDatabaseCreation",
                  "BaseDatabaseWrapper",
                  "BaseDatabaseOperations"
                ],
                "code_snippet": null,
                "file_pattern": "**/backends/sqlite3/**/*.py",
                "function_names": []
              }
            ]
          },
          "input_tokens": 4316,
          "output_tokens": 353,
          "retry_message": null,
          "completion_cost": 0.018243000000000002
        }
      ]
    },
    {
      "name": "IdentifyCode",
      "state": {
        "model": "deepseek-coder",
        "query": null,
        "class_name": null,
        "max_tokens": 1000,
        "temperature": 1.6,
        "code_snippet": null,
        "file_pattern": null,
        "ranked_spans": [
          {
            "rank": 0,
            "tokens": 895,
            "span_id": "DatabaseWrapper",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 0,
            "tokens": 7,
            "span_id": "DatabaseCreation",
            "file_path": "django/db/backends/sqlite3/creation.py"
          },
          {
            "rank": 0,
            "tokens": 59,
            "span_id": "DatabaseCreation._get_test_db_name",
            "file_path": "django/db/backends/sqlite3/creation.py"
          },
          {
            "rank": 0,
            "tokens": 41,
            "span_id": "DatabaseCreation.is_in_memory_db",
            "file_path": "django/db/backends/sqlite3/creation.py"
          },
          {
            "rank": 0,
            "tokens": 61,
            "span_id": "DatabaseWrapper.close",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 0,
            "tokens": 7,
            "span_id": "DatabaseWrapper.init_connection_state",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 0,
            "tokens": 19,
            "span_id": "DatabaseWrapper.enable_constraint_checking",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 0,
            "tokens": 85,
            "span_id": "DatabaseWrapper._set_autocommit",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 0,
            "tokens": 92,
            "span_id": "DatabaseWrapper._savepoint_allowed",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 0,
            "tokens": 18,
            "span_id": "DatabaseWrapper.create_cursor",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 0,
            "tokens": 77,
            "span_id": "DatabaseWrapper.disable_constraint_checking",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 1,
            "tokens": 854,
            "span_id": "DatabaseWrapper.get_new_connection",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 1,
            "tokens": 895,
            "span_id": "DatabaseWrapper",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 1,
            "tokens": 895,
            "span_id": "DatabaseWrapper",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 2,
            "tokens": 104,
            "span_id": "DatabaseCreation.test_db_signature",
            "file_path": "django/db/backends/sqlite3/creation.py"
          },
          {
            "rank": 2,
            "tokens": 41,
            "span_id": "DatabaseCreation._destroy_test_db",
            "file_path": "django/db/backends/sqlite3/creation.py"
          },
          {
            "rank": 3,
            "tokens": 61,
            "span_id": "DatabaseWrapper.close",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 3,
            "tokens": 7,
            "span_id": "DatabaseWrapper.init_connection_state",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 3,
            "tokens": 19,
            "span_id": "DatabaseWrapper.enable_constraint_checking",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 3,
            "tokens": 85,
            "span_id": "DatabaseWrapper._set_autocommit",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 3,
            "tokens": 92,
            "span_id": "DatabaseWrapper._savepoint_allowed",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 3,
            "tokens": 18,
            "span_id": "DatabaseWrapper.create_cursor",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 3,
            "tokens": 77,
            "span_id": "DatabaseWrapper.disable_constraint_checking",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 3,
            "tokens": 201,
            "span_id": "DatabaseCreation._clone_test_db",
            "file_path": "django/db/backends/sqlite3/creation.py"
          },
          {
            "rank": 3,
            "tokens": 78,
            "span_id": "DatabaseCreation.get_test_db_clone_settings",
            "file_path": "django/db/backends/sqlite3/creation.py"
          },
          {
            "rank": 3,
            "tokens": 854,
            "span_id": "DatabaseWrapper.get_new_connection",
            "file_path": "django/db/backends/sqlite3/base.py"
          },
          {
            "rank": 4,
            "tokens": 210,
            "span_id": "DatabaseCreation._create_test_db",
            "file_path": "django/db/backends/sqlite3/creation.py"
          }
        ],
        "function_name": null,
        "expand_context": true,
        "max_iterations": null,
        "max_prompt_file_tokens": 4000,
        "include_message_history": false
      },
      "actions": [
        {
          "action": {
            "scratch_pad": "The reported issue is related to the failure of the admin_views.test_multidb test when using persistent SQLite databases, specifically encountering a 'database is locked' error. The provided search results contain multiple code spans from django/db/backends/sqlite3/base.py and django/db/backends/sqlite3/creation.py. These files are relevant because they deal with the SQLite database backend in Django, which is directly involved in the reported issue. Notably, the DatabaseWrapper class in base.py handles various aspects of database operations, including connection management, which could be where the 'database is locked' error originates. The DatabaseCreation class in creation.py is also relevant as it deals with the creation and management of test databases, which is central to the test failure scenario described. The spans 'DatabaseWrapper.get_new_connection', 'DatabaseCreation.is_in_memory_db', 'DatabaseCreation._get_test_db_name', and 'DatabaseCreation._create_test_db' are particularly pertinent as they deal with establishing new database connections and managing test database names, which are critical areas related to the issue.",
            "identified_spans": [
              {
                "span_ids": [
                  "DatabaseWrapper.get_new_connection"
                ],
                "file_path": "django/db/backends/sqlite3/base.py"
              },
              {
                "span_ids": [
                  "DatabaseCreation.is_in_memory_db",
                  "DatabaseCreation._get_test_db_name",
                  "DatabaseCreation._create_test_db"
                ],
                "file_path": "django/db/backends/sqlite3/creation.py"
              }
            ]
          },
          "output": {},
          "input_tokens": 6132,
          "output_tokens": 391,
          "retry_message": null,
          "completion_cost": 0.024260999999999998
        }
      ]
    },
    {
      "name": "DecideRelevance",
      "state": {
        "model": "deepseek-coder",
        "max_tokens": 1000,
        "temperature": 1.6,
        "expand_context": true,
        "max_iterations": null,
        "max_prompt_file_tokens": 4000,
        "include_message_history": false,
        "finish_after_relevant_count": 2
      },
      "actions": [
        {
          "action": {
            "complete": true,
            "relevant": true,
            "scratch_pad": "The file context provided includes key components from Django's SQLite3 backend, specifically focusing on the `DatabaseWrapper` and `DatabaseCreation` classes. These components handle database connections, operations, and test database creation, which are directly related to the reported issue of a SQLite database being locked during tests. The `DatabaseWrapper` class in `django/db/backends/sqlite3/base.py` includes methods for creating new connections and managing functions and aggregates, which could influence how the locking issue is managed. Additionally, `DatabaseCreation` in `django/db/backends/sqlite3/creation.py` deals with test database setup and teardown, including the management of persistent test databases. While the exact method causing the `database is locked` error isn't pinpointed in the provided context, the code provided is sufficient to understand the general area and mechanisms involved in the reported issue. Therefore, relevant code is provided, and the search for further specific fixes can proceed based on this context.",
            "search_suggestions": null
          },
          "output": {},
          "input_tokens": 6945,
          "output_tokens": 241,
          "retry_message": null,
          "completion_cost": 0.02445
        }
      ]
    },
    {
      "name": "PlanToCode",
      "state": {
        "diff": null,
        "model": "deepseek-coder",
        "message": null,
        "max_tokens": 1000,
        "temperature": 1.6,
        "max_iterations": 8,
        "finish_on_review": false,
        "verification_errors": null,
        "max_prompt_file_tokens": 4000,
        "include_message_history": true,
        "allow_hallucinated_spans": false,
        "max_tokens_in_edit_prompt": 500,
        "expand_context_with_related_spans": true
      },
      "actions": [
        {
          "action": {
            "action": "modify",
            "finish": null,
            "reject": null,
            "span_id": "DatabaseCreation._get_test_db_name",
            "file_path": "django/db/backends/sqlite3/creation.py",
            "scratch_pad": "The issue of 'database is locked' with persistent SQLite databases during testing can often be mitigated by ensuring that SQLite's shared-cache mode is enabled. This mode allows for multiple connections to share the same cache, reducing the likelihood of lock contention. The `DatabaseCreation` class in `creation.py` should be updated to ensure this mode is enabled when creating test databases.",
            "instructions": "Update the `_get_test_db_name` method in the `DatabaseCreation` class to enable SQLite's shared-cache mode by appending `&cache=shared` to the database URL when the test database name is not ':memory:'."
          },
          "output": {
            "span_id": "DatabaseCreation._get_test_db_name",
            "end_line": 21,
            "file_path": "django/db/backends/sqlite3/creation.py",
            "start_line": 17,
            "instructions": "Update the `_get_test_db_name` method in the `DatabaseCreation` class to enable SQLite's shared-cache mode by appending `&cache=shared` to the database URL when the test database name is not ':memory:'."
          },
          "input_tokens": 7911,
          "output_tokens": 199,
          "retry_message": null,
          "completion_cost": 0.026718000000000002
        }
      ]
    },
    {
      "name": "EditCode",
      "state": {
        "model": "deepseek-coder",
        "verify": true,
        "span_id": "DatabaseCreation._get_test_db_name",
        "end_line": 21,
        "file_path": "django/db/backends/sqlite3/creation.py",
        "max_tokens": 1000,
        "start_line": 17,
        "temperature": 1.6,
        "instructions": "Update the `_get_test_db_name` method in the `DatabaseCreation` class to enable SQLite's shared-cache mode by appending `&cache=shared` to the database URL when the test database name is not ':memory:'.",
        "max_iterations": 8,
        "chain_of_thought": false,
        "show_file_context": true,
        "show_initial_message": true,
        "max_prompt_file_tokens": 4000,
        "include_message_history": true
      },
      "actions": [
        {
          "action": {
            "content": "```\n<replace>\n    def _get_test_db_name(self):\n        test_database_name = self.connection.settings_dict['TEST']['NAME'] or ':memory:'\n        if test_database_name == ':memory:':\n            return 'file:memorydb_%s?mode=memory&cache=shared' % self.connection.alias\n        return test_database_name + '&cache=shared'\n</replace>"
          },
          "output": {
            "diff": "--- django/db/backends/sqlite3/creation.py\n+++ django/db/backends/sqlite3/creation.py\n@@ -18,7 +18,7 @@\n         test_database_name = self.connection.settings_dict['TEST']['NAME'] or ':memory:'\n         if test_database_name == ':memory:':\n             return 'file:memorydb_%s?mode=memory&cache=shared' % self.connection.alias\n-        return test_database_name\n+        return test_database_name + '&cache=shared'\n \n     def _create_test_db(self, verbosity, autoclobber, keepdb=False):\n         test_database_name = self._get_test_db_name()\n",
            "message": "Applied the change to django/db/backends/sqlite3/creation.py.\n\n<scratch_pad>\n```\n</scratch_pad>",
            "verification_errors": []
          },
          "input_tokens": 7709,
          "output_tokens": 99,
          "retry_message": null,
          "completion_cost": 0.024612000000000002
        }
      ]
    },
    {
      "name": "PlanToCode",
      "state": {
        "diff": "--- django/db/backends/sqlite3/creation.py\n+++ django/db/backends/sqlite3/creation.py\n@@ -18,7 +18,7 @@\n         test_database_name = self.connection.settings_dict['TEST']['NAME'] or ':memory:'\n         if test_database_name == ':memory:':\n             return 'file:memorydb_%s?mode=memory&cache=shared' % self.connection.alias\n-        return test_database_name\n+        return test_database_name + '&cache=shared'\n \n     def _create_test_db(self, verbosity, autoclobber, keepdb=False):\n         test_database_name = self._get_test_db_name()\n",
        "model": "deepseek-coder",
        "message": "Applied the change to django/db/backends/sqlite3/creation.py.\n\n<scratch_pad>\n```\n</scratch_pad>",
        "max_tokens": 1000,
        "temperature": 1.6,
        "max_iterations": 8,
        "finish_on_review": false,
        "verification_errors": [],
        "max_prompt_file_tokens": 4000,
        "include_message_history": true,
        "allow_hallucinated_spans": false,
        "max_tokens_in_edit_prompt": 500,
        "expand_context_with_related_spans": true
      },
      "actions": [
        {
          "action": {
            "action": "finish",
            "finish": "Changes applied to enable SQLite's shared cache mode for persistent test databases should resolve the 'database is locked' issue reported.",
            "reject": null,
            "span_id": null,
            "file_path": null,
            "scratch_pad": "The changes applied in the `_get_test_db_name` method to append `&cache=shared` to the database URL when the test database name is not ':memory:' should help mitigate the 'database is locked' issue for persistent SQLite databases during testing. With the shared cache mode enabled, SQLite can manage multiple connections more efficiently, reducing the likelihood of lock contention.",
            "instructions": null
          },
          "output": {
            "message": "Changes applied to enable SQLite's shared cache mode for persistent test databases should resolve the 'database is locked' issue reported."
          },
          "input_tokens": 8350,
          "output_tokens": 164,
          "retry_message": null,
          "completion_cost": 0.02751
        }
      ]
    },
    {
      "name": "Finished",
      "state": {
        "model": "gpt-4o",
        "output": {
          "model": "deepseek-coder",
          "temperature": 1.6
        },
        "message": "Changes applied to enable SQLite's shared cache mode for persistent test databases should resolve the 'database is locked' issue reported.",
        "max_tokens": 1000,
        "temperature": 0.0,
        "max_iterations": null,
        "include_message_history": false
      },
      "actions": []
    }
  ],
  "initial_message": "admin_views.test_multidb fails with persistent test SQLite database.\nDescription\n\t \n\t\t(last modified by Mariusz Felisiak)\n\t \nI've tried using persistent SQLite databases for the tests (to make use of\n--keepdb), but at least some test fails with:\nsqlite3.OperationalError: database is locked\nThis is not an issue when only using TEST[\"NAME\"] with \"default\" (which is good enough in terms of performance).\ndiff --git i/tests/test_sqlite.py w/tests/test_sqlite.py\nindex f1b65f7d01..9ce4e32e14 100644\n--- i/tests/test_sqlite.py\n+++ w/tests/test_sqlite.py\n@@ -15,9 +15,15 @@\n DATABASES = {\n\t 'default': {\n\t\t 'ENGINE': 'django.db.backends.sqlite3',\n+\t\t'TEST': {\n+\t\t\t'NAME': 'test_default.sqlite3'\n+\t\t},\n\t },\n\t 'other': {\n\t\t 'ENGINE': 'django.db.backends.sqlite3',\n+\t\t'TEST': {\n+\t\t\t'NAME': 'test_other.sqlite3'\n+\t\t},\n\t }\n }\n% tests/runtests.py admin_views.test_multidb -v 3 --keepdb --parallel 1\n\u2026\nOperations to perform:\n Synchronize unmigrated apps: admin_views, auth, contenttypes, messages, sessions, staticfiles\n Apply all migrations: admin, sites\nRunning pre-migrate handlers for application contenttypes\nRunning pre-migrate handlers for application auth\nRunning pre-migrate handlers for application sites\nRunning pre-migrate handlers for application sessions\nRunning pre-migrate handlers for application admin\nRunning pre-migrate handlers for application admin_views\nSynchronizing apps without migrations:\n Creating tables...\n\tRunning deferred SQL...\nRunning migrations:\n No migrations to apply.\nRunning post-migrate handlers for application contenttypes\nRunning post-migrate handlers for application auth\nRunning post-migrate handlers for application sites\nRunning post-migrate handlers for application sessions\nRunning post-migrate handlers for application admin\nRunning post-migrate handlers for application admin_views\nSystem check identified no issues (0 silenced).\nERROR\n======================================================================\nERROR: setUpClass (admin_views.test_multidb.MultiDatabaseTests)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n File \"\u2026/Vcs/django/django/db/backends/utils.py\", line 84, in _execute\n\treturn self.cursor.execute(sql, params)\n File \"\u2026/Vcs/django/django/db/backends/sqlite3/base.py\", line 391, in execute\n\treturn Database.Cursor.execute(self, query, params)\nsqlite3.OperationalError: database is locked\nThe above exception was the direct cause of the following exception:\nTraceback (most recent call last):\n File \"\u2026/Vcs/django/django/test/testcases.py\", line 1137, in setUpClass\n\tcls.setUpTestData()\n File \"\u2026/Vcs/django/tests/admin_views/test_multidb.py\", line 40, in setUpTestData\n\tusername='admin', password='something', email='test@test.org',\n File \"\u2026/Vcs/django/django/contrib/auth/models.py\", line 158, in create_superuser\n\treturn self._create_user(username, email, password, **extra_fields)\n File \"\u2026/Vcs/django/django/contrib/auth/models.py\", line 141, in _create_user\n\tuser.save(using=self._db)\n File \"\u2026/Vcs/django/django/contrib/auth/base_user.py\", line 66, in save\n\tsuper().save(*args, **kwargs)\n File \"\u2026/Vcs/django/django/db/models/base.py\", line 741, in save\n\tforce_update=force_update, update_fields=update_fields)\n File \"\u2026/Vcs/django/django/db/models/base.py\", line 779, in save_base\n\tforce_update, using, update_fields,\n File \"\u2026/Vcs/django/django/db/models/base.py\", line 870, in _save_table\n\tresult = self._do_insert(cls._base_manager, using, fields, update_pk, raw)\n File \"\u2026/Vcs/django/django/db/models/base.py\", line 908, in _do_insert\n\tusing=using, raw=raw)\n File \"\u2026/Vcs/django/django/db/models/manager.py\", line 82, in manager_method\n\treturn getattr(self.get_queryset(), name)(*args, **kwargs)\n File \"\u2026/Vcs/django/django/db/models/query.py\", line 1175, in _insert\n\treturn query.get_compiler(using=using).execute_sql(return_id)\n File \"\u2026/Vcs/django/django/db/models/sql/compiler.py\", line 1321, in execute_sql\n\tcursor.execute(sql, params)\n File \"\u2026/Vcs/django/django/db/backends/utils.py\", line 67, in execute\n\treturn self._execute_with_wrappers(sql, params, many=False, executor=self._execute)\n File \"\u2026/Vcs/django/django/db/backends/utils.py\", line 76, in _execute_with_wrappers\n\treturn executor(sql, params, many, context)\n File \"\u2026/Vcs/django/django/db/backends/utils.py\", line 84, in _execute\n\treturn self.cursor.execute(sql, params)\n File \"\u2026/Vcs/django/django/db/utils.py\", line 89, in __exit__\n\traise dj_exc_value.with_traceback(traceback) from exc_value\n File \"\u2026/Vcs/django/django/db/backends/utils.py\", line 84, in _execute\n\treturn self.cursor.execute(sql, params)\n File \"\u2026/Vcs/django/django/db/backends/sqlite3/base.py\", line 391, in execute\n\treturn Database.Cursor.execute(self, query, params)\ndjango.db.utils.OperationalError: database is locked\n"
}